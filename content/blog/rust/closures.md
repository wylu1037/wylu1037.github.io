---
title: é—­åŒ…
date: 2024-06-02T21:25:14+08:00
---

é—­åŒ…ï¼ˆClosuresï¼‰æ˜¯ä¸€ç§å¯ä»¥æ•è·å…¶ç¯å¢ƒçš„åŒ¿åå‡½æ•°ã€‚é—­åŒ…å¯ä»¥å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œæˆ–è€…ä»å…¶ä»–å‡½æ•°ä¸­è¿”å›ã€‚å®ƒä»¬å¯ä»¥æ•è·ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡ï¼Œä½¿å…¶åœ¨é—­åŒ…ä½“å†…ä½¿ç”¨ã€‚
Rust æä¾›äº†ä¸‰ç§ç±»å‹çš„é—­åŒ…ï¼Œåˆ†åˆ«æ˜¯ `Fn`ã€`FnMut` å’Œ `FnOnce`ã€‚

é—­åŒ…è¯­æ³•å¦‚ä¸‹ï¼š
```
|å‚æ•°åˆ—è¡¨| è¡¨è¾¾å¼
```

ç¤ºä¾‹ï¼š
```rust
let add = |x, y| x + y;
let result = add(2, 3);
```

## å¸¦æœ‰ç±»å‹æ³¨è§£çš„é—­åŒ…
å¯ä»¥æ˜¾å¼åœ°ä¸ºé—­åŒ…çš„å‚æ•°å’Œè¿”å›ç±»å‹æ·»åŠ ç±»å‹æ³¨è§£ã€‚
```rust
let add = |x: i32, y: i32| -> i32 { x + y };
let result = add(2, 3);
```

## ğŸ’¢ é—­åŒ…æ•è·ç¯å¢ƒ
é—­åŒ…å¯ä»¥æ•è·å…¶å®šä¹‰æ‰€åœ¨ä½œç”¨åŸŸçš„å˜é‡ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼š

1. **æŒ‰å¼•ç”¨æ•è·ï¼ˆFnï¼‰**ï¼šé—­åŒ…ä»¥ä¸å¯å˜å¼•ç”¨çš„æ–¹å¼æ•è·å˜é‡ã€‚
2. **æŒ‰å¯å˜å¼•ç”¨æ•è·ï¼ˆFnMutï¼‰**ï¼šé—­åŒ…ä»¥å¯å˜å¼•ç”¨çš„æ–¹å¼æ•è·å˜é‡ã€‚
3. **æŒ‰å€¼æ•è·ï¼ˆFnOnceï¼‰**ï¼šé—­åŒ…è·å–å˜é‡çš„æ‰€æœ‰æƒï¼Œåªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚

**ç¤ºä¾‹**ï¼š
```rust
fn main() {
    let x = 10;

    // æŒ‰å¼•ç”¨æ•è·
    let add_to_x = |y: i32| x + y;
    println!("10 + 5 = {}", add_to_x(5));

    let mut z = 10;

    // æŒ‰å¯å˜å¼•ç”¨æ•è·
    let mut add_to_z = |y: i32| z += y;
    add_to_z(5);
    println!("10 + 5 = {}", z);

    // æŒ‰å€¼æ•è·
    let move_z = move |y: i32| z + y;
    println!("15 + 5 = {}", move_z(5));
}
```

## é—­åŒ…ä½œä¸ºå‡½æ•°å‚æ•°
é—­åŒ…å¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ Fnã€FnMut æˆ– FnOnce è¿›è¡Œé™å®šï¼š
```rust
fn apply_to_3<F>(f: F) -> i32
where
    F: Fn(i32) -> i32,
{
    f(3)
}

fn main() {
    let double = |x| x * 2;
    let result = apply_to_3(double);
    println!("3 * 2 = {}", result);
}
```

## é—­åŒ…ä½œä¸ºè¿”å›å€¼
å‡½æ•°ä¹Ÿå¯ä»¥è¿”å›é—­åŒ…ï¼Œè¿™éœ€è¦ä½¿ç”¨ `impl Trait` æˆ–è€…ç›’è£…ï¼ˆBoxedï¼‰é—­åŒ…ï¼š
```rust
fn returns_closure() -> impl Fn(i32) -> i32 {
    |x| x + 1
}

fn main() {
    let closure = returns_closure();
    println!("4 + 1 = {}", closure(4));
}
```

æˆ–è€…ä½¿ç”¨ç›’è£…é—­åŒ…ï¼š
```rust
fn returns_closure() -> Box<dyn Fn(i32) -> i32> {
    Box::new(|x| x + 1)
}

fn main() {
    let closure = returns_closure();
    println!("4 + 1 = {}", closure(4));
}
```

## ğŸ¤– é¢è¯•